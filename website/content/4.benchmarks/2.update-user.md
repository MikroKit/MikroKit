---
toc: false
title: Update User
---

# Update User Benchmarks

These benchmarks are based on the [fastify benchmarks](https://github.com/fastify/benchmarks){target="_blank"} repo! in fact our goal is to perform similar to fastify as we considered it the industry standard in terms of performance.

Note that using an RPC style router avoids possible performance overhead that can come from parsing parameters in the path i.e: `/api/user/:id`.

## What is tested?

::alert{type="success"}
This **Update User** benchmark involves validation and serialization on top of routing.
::

The test consist of an `updateUser` request where the fields of the user must be deserialized and validated and response must be serialized.

The `lastUpdate` field is a date that must be transformed into a JS `Date` (deserialized) and validated, then a month is added to the Date and the updated user is send back in the response.

```ts
export interface User {
  id: number;
  name: string;
  surname: string;
  lastUpdate: Date;
}

// ### mion ###
// the received user by the route is already validated and deserialized
// user.lastUpdate is already a js date instead and string (result of JSON.parse)
const routes = {
  updateUser: (ctx, user: User): User => {
    user.lastUpdate.setMonth(user.lastUpdate.getMonth() + 1);
    return user;
  },
} satisfies Routes;

// ### Express ###
// A plugin must be used to parse the json body
// validation must be done manually and user.lastUpdate must be deserialized manually into a date
// in this case developer would have to manually write `isUser` and `deserializeUser` functions. (check src code fo those functions)
app.post('/updateUser', function (req, res) {
  const rawUser = req.body?.updateUser;
  if (!isUser(rawUser)) throw 'app error, invalid parameter, not a user';
  const user = deserializeUser(rawUser);
  user.lastUpdate.setMonth(user.lastUpdate.getMonth() + 1);
  res.json(user);
});
```

### Notes

We can observe how in this benchmark the requests takes considerably more time compared with the hello world benchmark. This is mostly because each request is spending extra time on validation and serialization.

:spacer

## Benchmarks

* __Machine:__ darwin x64 | 8 vCPUs | 16.0GB Mem
* __Node:__ `v18.17.0`
* __Run:__ Mon Jan 22 2024 03:07:04 GMT+0000 (Greenwich Mean Time)
* __Method:__ `autocannon -c 100 -d 40.02 -p 10 localhost:3000` (two rounds; one to warm-up, one to measure)

#### Req (R/s) 

:bench-chart{id='hello-requests'}

#### Throughput (Mb/s) 

:bench-chart{id='hello-throughput'}

#### Latency (ms) 

:bench-chart{id='hello-latency'}

#### Max Memory (Mb) 

:bench-chart{id='hello-max-mem'}

#### Memory Series (MB) 

:bench-chart{id='hello-mem-series'}


## Results Table

|           | Version        | Router | Req (R/s)   | Latency (ms) | Output (Mb/s) | Max Memory (Mb) | Max Cpu (%) | Validation | Description                                                                                 |
| :--       | --:            | --:    | :-:         | --:          | --:           | --:             | --:         | :-:        | :--                                                                                         |
| http-node | 16.18.0        | ✗      | 17719.7     | 56.02        | 4.26          | 84              | 116         | ✗          | bare node http server, should be the theoretical upper limit in node.js performance         |
| mion.bun  | 0.6.2          | ✓      | 17184.4     | 57.66        | 3.98          | 110             | 106         | ✓          | mion using bun, automatic validation and serialization                                      |
| fastify   | 4.10.2         | ✓      | 15790.8     | 62.79        | 3.81          | 96              | 117         | -          | Validation using schemas and ajv. schemas are generated manually or using third party tools |
| **mion**  | **0.6.2**      | **✓**  | **12981.2** | **76.44**    | **3.59**      | **107**         | **146**     | **✓**      | **Automatic validation and serialization out of the box**                                   |
| restify   | 11.1.0         | ✓      | 11567.2     | 85.87        | 2.97          | 110             | 120         | ✗          | manual validation or third party tools                                                      |
| hapi      | 21.3.2         | ✓      | 8465.5      | 117.48       | 2.03          | 121             | 130         | ✗          | validation using joi or third party tools                                                   |
| deepkit   | 1.0.1-alpha.75 | ✓      | 5375.5      | 185.16       | 1.29          | 301             | 154         | ✓          | Automatic validation and serialization out of the box                                       |
| hono      | 3.12.6         | ✓      | 4861.8      | 204.73       | 1.17          | 137             | 132         | ✗          | hono node server, manual validation or third party tools                                    |
| express   | 4.18.2         | ✓      | 4593.2      | 216.66       | 1.10          | 120             | 125         | ✗          | manual validation or third party tools                                                      |


